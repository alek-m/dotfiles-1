#!/bin/sh
#
# pbrisbin 2015 - check that a proxy is working
#
###
check_ip() {
  curl --silent checkip.dyndns.org | sed 's/.*IP Address: \([^<]*\).*/\1/'
}

local_ip=$(check_ip)
local_ip=${local_ip:-UNKNOWN}

proxied_ip=$(http_proxy=172.17.42.1:8118 check_ip)
proxied_ip=${proxied_ip:-UNKNOWN}

printf "IP address: %s\n" "$local_ip"
printf "Via proxy:  %s\n" "$proxied_ip"

# exit sucessfully iff proxy is in effect
test "$local_ip" != "$proxied_ip"
