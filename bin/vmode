#!/usr/bin/env ruby
#
# pbrisbin 2013 - xrandr wrapper that does smart things.
#
###
xrandr_output = `xrandr --query`
xrandr_args = []

# turn off all disconnected displays
xrandr_output.scan(/^(.*) disconnected/) do |name,_|
  xrandr_args << "--output #{name} --off"
end

pattern = /\n([^\n]*) connected [^\n]*\n *(\d+x\d+)/m

# first connected output, at its first mode, right of primary
(primary, _), (name, mode), _ = xrandr_output.scan(pattern)

if name
  xrandr_args << "--output #{name} --off"
  xrandr_args << "--output #{name} --mode #{mode} --right-of #{primary}"
end

system("xrandr #{xrandr_args.join(' ')}")
system('feh --bg-max ~/.background.png')
system('pkill notify-osd')
